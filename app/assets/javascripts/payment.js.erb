

var handler = StripeCheckout.configure({
 key: '<%= Rails.configuration.stripe[:publishable_key] %>',
 locale: 'auto',
 name: 'PeerTutor',
 email: '',
 description: 'One-time Payment',
 token: function(token) {
   $('input#stripeToken').val(token.id);
   $('form').submit();
 }
});
$('#PayButton').on('click', function(e) {
 e.preventDefault();
 $('#error_explanation').html('');
 var amount = $('input#amount').val();
 amount = amount.replace(/\$/g, '').replace(/\,/g, '')
 amount = parseFloat(amount);
 if (isNaN(amount)) {
   $('#error_explanation').html('<p>Please enter a valid amount in USD ($).</p>');
 }
 else if (amount < 5.00) {
   $('#error_explanation').html('<p>Payment amount must be at least $5.</p>');
 }
 else {
   amount = amount * 100; // Needs to be an integer!
   handler.open({
     amount: Math.round(amount)
   })
 }
});
$(window).on('popstate', function() {
 handler.close();
});
